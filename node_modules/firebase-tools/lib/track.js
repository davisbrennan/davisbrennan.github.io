"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.track = void 0;
const ua = require("universal-analytics");
const uuid_1 = require("uuid");
const configstore_1 = require("./configstore");
const pkg = require("../package.json");
let anonId = configstore_1.configstore.get("analytics-uuid");
if (!anonId) {
    anonId = (0, uuid_1.v4)();
    configstore_1.configstore.set("analytics-uuid", anonId);
}
const visitor = ua(process.env.FIREBASE_ANALYTICS_UA || "UA-29174744-3", anonId, {
    strictCidFormat: false,
    https: true,
});
visitor.set("cd1", process.platform);
visitor.set("cd2", process.version);
visitor.set("cd3", process.env.FIREPIT_VERSION || "none");
function track(action, label, duration = 0) {
    return new Promise((resolve) => {
        if (configstore_1.configstore.get("tokens") && configstore_1.configstore.get("usage")) {
            visitor.event("Firebase CLI " + pkg.version, action, label, duration).send(() => {
                resolve();
            });
        }
        else {
            resolve();
        }
    });
}
exports.track = track;
